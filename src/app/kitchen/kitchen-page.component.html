<h2>Kalkulator kuchni</h2>

<!-- ============ G≈Å√ìWNY GRID: WIZUALIZACJA + FORMULARZ ============ -->
<div class="main-workspace">

  <!-- LEWA KOLUMNA: Wizualizacje + Wymiary -->
  <div class="visualization-column">

    <!-- Widok z g√≥ry (floor plan) + Wymiary ≈õciany -->
    <div class="floor-plan-section">
      <app-kitchen-floor-plan
        (addWallRequested)="onAddWallRequested()"
        (wallRemoved)="onWallRemoved($event)">
      </app-kitchen-floor-plan>

      <!-- Wymiary wybranej ≈õciany - pod floor plan -->
      <div class="wall-dimensions-inline">
        <span class="wall-name">{{ selectedWallLabel }}:</span>
        <label>
          <span>D≈Ç.</span>
          <input type="number" [(ngModel)]="wallLength" (change)="onWallChange()" class="dim-input">
          <span class="unit">mm</span>
        </label>
        <label>
          <span>Wys.</span>
          <input type="number" [(ngModel)]="wallHeight" (change)="onWallChange()" class="dim-input">
          <span class="unit">mm</span>
        </label>
      </div>
    </div>

    <!-- Widok od frontu -->
    <app-kitchen-layout></app-kitchen-layout>
  </div>

  <!-- PRAWA KOLUMNA: Formularz szafki -->
  <div class="form-column">
    <div class="cabinet-form-card">
      <h3>{{ formTitle }}</h3>
      <app-cabinet-form
        [editingCabinet]="editingCabinet"
        (calculated)="onCabinetCalculated($event)"
        (cancelEdit)="onCancelEdit()">
      </app-cabinet-form>
    </div>

    <!-- Wynik ostatniej kalkulacji (kompaktowy) -->
    <app-cabinet-result
      *ngIf="result"
      [result]="result">
    </app-cabinet-result>
  </div>
</div>

<!-- ============ LISTA SZAFEK ============ -->
<section class="cabinet-list-section">
  <div class="section-header">
    <h3>Szafki na ≈õcianie: {{ selectedWallLabel }} ({{ cabinets().length }})</h3>
    <button
      *ngIf="cabinets().length > 0"
      class="btn-clear-wall"
      (click)="clearSelectedWallCabinets()"
      [disabled]="editingCabinetId !== null">
      Wyczy≈õƒá szafki
    </button>
  </div>

  <app-kitchen-cabinet-list
    [cabinets]="cabinets()"
    [editingCabinetId]="editingCabinetId"
    (edit)="onEditCabinet($event)"
    (remove)="onRemoveCabinet($event)">
  </app-kitchen-cabinet-list>
</section>

<!-- ============ PODSUMOWANIE (ULEPSZONY WYGLƒÑD) ============ -->
<div class="summary-cards" *ngIf="totalCabinetCount() > 0">

  <!-- Karta: Wybrana ≈õciana -->
  <div class="summary-card wall-summary" *ngIf="cabinets().length > 0">
    <div class="card-header">
      <span class="card-icon">üß±</span>
      <h4>{{ selectedWallLabel }}</h4>
    </div>
    <div class="card-stats">
      <div class="stat">
        <span class="stat-value">{{ cabinets().length }}</span>
        <span class="stat-label">szafek</span>
      </div>
      <div class="stat">
        <span class="stat-value">{{ totalWidth() }}</span>
        <span class="stat-label">mm zajƒôte</span>
      </div>
      <div class="stat">
        <span class="stat-value">{{ selectedWallTotalCost().toFixed(0) }}</span>
        <span class="stat-label">z≈Ç</span>
      </div>
    </div>
    <div class="card-status" [class.fits]="fitsOnWall()" [class.overflow]="!fitsOnWall()">
      {{ fitsOnWall() ? '‚úì Mie≈õci siƒô' : '‚úó Nie mie≈õci siƒô!' }}
      <span class="remaining">({{ remainingWidth() }} mm wolne)</span>
    </div>
  </div>

  <!-- Karta: Ca≈Çy projekt -->
  <div class="summary-card project-summary-card">
    <div class="card-header">
      <span class="card-icon">üìê</span>
      <h4>Ca≈Çy projekt</h4>
    </div>
    <div class="card-stats">
      <div class="stat">
        <span class="stat-value">{{ walls().length }}</span>
        <span class="stat-label">≈õcian</span>
      </div>
      <div class="stat">
        <span class="stat-value">{{ totalCabinetCount() }}</span>
        <span class="stat-label">szafek</span>
      </div>
      <div class="stat highlight">
        <span class="stat-value">{{ totalCost().toFixed(0) }}</span>
        <span class="stat-label">z≈Ç razem</span>
      </div>
    </div>
    <div class="card-actions">
      <button
        class="btn-calculate"
        (click)="calculateProject()"
        [disabled]="editingCabinetId !== null || isCalculatingProject">
        {{ isCalculatingProject ? '‚è≥ Obliczam...' : 'üßÆ Wylicz projekt' }}
      </button>
      <button class="btn-clear-all" (click)="clearAll()" [disabled]="editingCabinetId !== null">
        üóëÔ∏è Wyczy≈õƒá
      </button>
    </div>
  </div>
</div>

<!-- ============ WYNIKI KALKULACJI PROJEKTU ============ -->
<section class="project-result" *ngIf="projectResult">
  <h3>üìä Wynik kalkulacji projektu</h3>

  <!-- Globalne podsumowanie koszt√≥w -->
  <div class="project-costs-grid">
    <div class="cost-item">
      <span class="cost-label">Koszt p≈Çyt:</span>
      <span class="cost-value">{{ projectResult.totalBoardCost.toFixed(2) }} z≈Ç</span>
    </div>
    <div class="cost-item">
      <span class="cost-label">Koszt komponent√≥w:</span>
      <span class="cost-value">{{ projectResult.totalComponentCost.toFixed(2) }} z≈Ç</span>
    </div>
    <div class="cost-item">
      <span class="cost-label">Koszt pracy:</span>
      <span class="cost-value">{{ projectResult.totalJobCost.toFixed(2) }} z≈Ç</span>
    </div>
    <div class="cost-item total">
      <span class="cost-label">RAZEM:</span>
      <span class="cost-value">{{ projectResult.totalProjectCost.toFixed(2) }} z≈Ç</span>
    </div>
  </div>

  <div class="layout-info">
    <p>≈öciany: {{ projectResult.wallCount }} | Szafki: {{ projectResult.totalCabinetCount }}</p>
    <p class="fits-status" [class.fits]="projectResult.allFit" [class.overflow]="!projectResult.allFit">
      {{ projectResult.allFit ? '‚úì Wszystkie szafki mieszczƒÖ siƒô na ≈õcianach' : '‚ö†Ô∏è Niekt√≥re szafki nie mieszczƒÖ siƒô!' }}
    </p>
  </div>

  <!-- Szczeg√≥≈Çy projektu - zak≈Çadki -->
  <div class="project-details-tabs">
    <div class="tabs-header">
      <button
        class="tab-btn"
        [class.active]="activeDetailsTab === 'walls'"
        (click)="activeDetailsTab = 'walls'">
        üß± ≈öciany ({{ projectResult.walls.length }})
      </button>
      <button
        class="tab-btn"
        [class.active]="activeDetailsTab === 'boards'"
        (click)="activeDetailsTab = 'boards'">
        ü™µ P≈Çyty
      </button>
      <button
        class="tab-btn"
        [class.active]="activeDetailsTab === 'components'"
        (click)="activeDetailsTab = 'components'">
        üî© Komponenty
      </button>
      <button
        class="tab-btn"
        [class.active]="activeDetailsTab === 'jobs'"
        (click)="activeDetailsTab = 'jobs'">
        üîß Prace
      </button>
    </div>

    <div class="tabs-content">
      <!-- Tab: ≈öciany -->
      <div class="tab-panel" *ngIf="activeDetailsTab === 'walls'">
        <div class="wall-detail" *ngFor="let wall of projectResult.walls">
          <div class="wall-detail-header">
            <h4>{{ wall.wallType }}</h4>
            <span class="wall-dimensions">{{ wall.widthMm }} √ó {{ wall.heightMm }} mm</span>
            <span class="wall-cost">{{ wall.wallTotalCost.toFixed(2) }} z≈Ç</span>
          </div>
          <div class="wall-detail-body">
            <p>
              Szafki: {{ wall.cabinetCount }} |
              Dolne: {{ wall.usedWidthBottom }}/{{ wall.widthMm }} mm |
              G√≥rne: {{ wall.usedWidthTop }}/{{ wall.widthMm }} mm
            </p>
            <p class="fits-status" [class.fits]="wall.fits" [class.overflow]="!wall.fits">
              {{ wall.fits ? '‚úì Mie≈õci siƒô' : '‚úó Nie mie≈õci siƒô!' }}
            </p>
          </div>
        </div>
      </div>

      <!-- Tab: P≈Çyty -->
      <div class="tab-panel" *ngIf="activeDetailsTab === 'boards'">
        <table class="details-table" *ngIf="aggregatedBoards.length > 0">
          <thead>
            <tr>
              <th>Materia≈Ç</th>
              <th>Wymiary (mm)</th>
              <th>Ilo≈õƒá</th>
              <th>Koszt jedn.</th>
              <th>Koszt ca≈Çk.</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let board of aggregatedBoards">
              <td>{{ board.material }} ({{ board.thickness }}mm)</td>
              <td>{{ board.width }} √ó {{ board.height }}</td>
              <td>{{ board.quantity }}</td>
              <td>{{ board.unitCost.toFixed(2) }} z≈Ç</td>
              <td>{{ board.totalCost.toFixed(2) }} z≈Ç</td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="4"><strong>Suma p≈Çyt:</strong></td>
              <td><strong>{{ projectResult.totalBoardCost.toFixed(2) }} z≈Ç</strong></td>
            </tr>
          </tfoot>
        </table>
        <p *ngIf="aggregatedBoards.length === 0" class="empty-message">Brak p≈Çyt do wy≈õwietlenia</p>
      </div>

      <!-- Tab: Komponenty -->
      <div class="tab-panel" *ngIf="activeDetailsTab === 'components'">
        <table class="details-table" *ngIf="aggregatedComponents.length > 0">
          <thead>
            <tr>
              <th>Nazwa</th>
              <th>Typ</th>
              <th>Ilo≈õƒá</th>
              <th>Koszt jedn.</th>
              <th>Koszt ca≈Çk.</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let comp of aggregatedComponents">
              <td>{{ comp.name }}</td>
              <td>{{ comp.type }}</td>
              <td>{{ comp.quantity }}</td>
              <td>{{ comp.unitCost.toFixed(2) }} z≈Ç</td>
              <td>{{ comp.totalCost.toFixed(2) }} z≈Ç</td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="4"><strong>Suma komponent√≥w:</strong></td>
              <td><strong>{{ projectResult.totalComponentCost.toFixed(2) }} z≈Ç</strong></td>
            </tr>
          </tfoot>
        </table>
        <p *ngIf="aggregatedComponents.length === 0" class="empty-message">Brak komponent√≥w do wy≈õwietlenia</p>
      </div>

      <!-- Tab: Prace -->
      <div class="tab-panel" *ngIf="activeDetailsTab === 'jobs'">
        <table class="details-table" *ngIf="aggregatedJobs.length > 0">
          <thead>
            <tr>
              <th>Nazwa</th>
              <th>Typ</th>
              <th>Ilo≈õƒá</th>
              <th>Koszt jedn.</th>
              <th>Koszt ca≈Çk.</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let job of aggregatedJobs">
              <td>{{ job.name }}</td>
              <td>{{ job.type }}</td>
              <td>{{ job.quantity }}</td>
              <td>{{ job.unitCost.toFixed(2) }} z≈Ç</td>
              <td>{{ job.totalCost.toFixed(2) }} z≈Ç</td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="4"><strong>Suma prac:</strong></td>
              <td><strong>{{ projectResult.totalJobCost.toFixed(2) }} z≈Ç</strong></td>
            </tr>
          </tfoot>
        </table>
        <p *ngIf="aggregatedJobs.length === 0" class="empty-message">Brak prac do wy≈õwietlenia</p>
      </div>
    </div>
  </div>
</section>

<!-- B≈ÇƒÖd kalkulacji projektu -->
<section class="project-error" *ngIf="projectError">
  <h3>‚ùå B≈ÇƒÖd kalkulacji</h3>
  <p class="error-message">{{ projectError }}</p>
</section>

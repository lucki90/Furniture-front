@if (cabinetInput(); as cab) {
  <svg
    [attr.width]="svgWidth()"
    [attr.height]="svgHeight()"
    [attr.viewBox]="'0 0 ' + svgWidth() + ' ' + svgHeight()"
    class="cabinet-detail-svg">

    <!-- Definicje gradientów -->
    <defs>
      <!-- Gradient dla frontu -->
      <linearGradient id="frontGradient" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" style="stop-color:#ffffff;stop-opacity:1" />
        <stop offset="100%" style="stop-color:#e0e0e0;stop-opacity:1" />
      </linearGradient>

      <!-- Gradient dla korpusu -->
      <linearGradient id="bodyGradient" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" style="stop-color:#bcaaa4;stop-opacity:1" />
        <stop offset="50%" style="stop-color:#d7ccc8;stop-opacity:1" />
        <stop offset="100%" style="stop-color:#bcaaa4;stop-opacity:1" />
      </linearGradient>

      <!-- Gradient dla blatu -->
      <linearGradient id="countertopGradient" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" style="stop-color:#8d6e63;stop-opacity:1" />
        <stop offset="50%" style="stop-color:#6d4c41;stop-opacity:1" />
        <stop offset="100%" style="stop-color:#5d4037;stop-opacity:1" />
      </linearGradient>

      <!-- Gradient dla cokołu -->
      <linearGradient id="plinthGradient" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" style="stop-color:#424242;stop-opacity:1" />
        <stop offset="100%" style="stop-color:#212121;stop-opacity:1" />
      </linearGradient>

      <!-- Cień -->
      <filter id="dropShadow" x="-20%" y="-20%" width="140%" height="140%">
        <feDropShadow dx="1" dy="1" stdDeviation="1" flood-opacity="0.3"/>
      </filter>
    </defs>

    <!-- BLAT (jeśli szafka dolna) -->
    @if (showCountertop) {
      <rect
        [attr.x]="bodyX - 3"
        [attr.y]="SVG_PADDING"
        [attr.width]="bodyWidth + 6"
        [attr.height]="countertopHeightScaled"
        fill="url(#countertopGradient)"
        stroke="#4e342e"
        stroke-width="0.5"
        rx="1"
        filter="url(#dropShadow)">
        <title>Blat</title>
      </rect>
    }

    <!-- KORPUS SZAFKI -->
    <rect
      [attr.x]="bodyX"
      [attr.y]="bodyY"
      [attr.width]="bodyWidth"
      [attr.height]="bodyHeightScaled"
      fill="url(#bodyGradient)"
      stroke="#8d6e63"
      stroke-width="0.5"
      rx="1">
      <title>Korpus: {{ cab.width }}x{{ bodyHeight() }}mm</title>
    </rect>

    <!-- FRONTY -->
    @for (front of fronts(); track $index) {
      <g class="front-group">
        <!-- Tło frontu -->
        <rect
          [attr.x]="getFrontX(front)"
          [attr.y]="getFrontY(front)"
          [attr.width]="getFrontWidth(front)"
          [attr.height]="getFrontHeight(front)"
          fill="url(#frontGradient)"
          [attr.stroke]="frontStroke"
          stroke-width="0.5"
          rx="1"
          class="front-rect">
          <title>{{ front.type === 'DRAWER' ? 'Szuflada' : 'Front' }}: {{ front.width }}x{{ front.height }}mm</title>
        </rect>

        <!-- Zawiasy (dla drzwi) -->
        @if (hasHinges(front)) {
          @for (hinge of getHingePositions(front); track $index) {
            <rect
              [attr.x]="hinge.x - 1"
              [attr.y]="hinge.y - 3"
              width="2"
              height="6"
              [attr.fill]="hingeColor"
              rx="0.5"
              class="hinge">
              <title>Zawias</title>
            </rect>
          }
        }

        <!-- Uchwyt - linia (dla BAR, SHELL, EDGE) -->
        @if (getHandlePath(front)) {
          <path
            [attr.d]="getHandlePath(front)"
            [attr.stroke]="getHandleColor(front)"
            stroke-width="3"
            stroke-linecap="round"
            fill="none"
            class="handle-bar"
            filter="url(#dropShadow)">
            <title>Uchwyt</title>
          </path>
        }

        <!-- Uchwyt - gałka (dla KNOB) -->
        @if (isKnobHandle(front)) {
          <circle
            [attr.cx]="getKnobX(front)"
            [attr.cy]="getKnobY(front)"
            r="4"
            [attr.fill]="getHandleColor(front)"
            stroke="#546e7a"
            stroke-width="0.5"
            class="handle-knob"
            filter="url(#dropShadow)">
            <title>Gałka</title>
          </circle>
        }

        <!-- Linia szuflady (wizualna separacja) -->
        @if (front.type === 'DRAWER') {
          <line
            [attr.x1]="getFrontX(front) + 2"
            [attr.y1]="getFrontY(front) + getFrontHeight(front) - 1"
            [attr.x2]="getFrontX(front) + getFrontWidth(front) - 2"
            [attr.y2]="getFrontY(front) + getFrontHeight(front) - 1"
            stroke="#bdbdbd"
            stroke-width="0.5"
            class="drawer-line"/>
        }
      </g>
    }

    <!-- COKÓŁ -->
    @if (showPlinth) {
      <rect
        [attr.x]="bodyX + plinthSetback"
        [attr.y]="baseY"
        [attr.width]="bodyWidth - plinthSetback * 2"
        [attr.height]="baseHeightScaled"
        fill="url(#plinthGradient)"
        stroke="#1a1a1a"
        stroke-width="0.5"
        rx="1"
        class="plinth">
        <title>Cokół: {{ baseHeight() }}mm</title>
      </rect>
    }

    <!-- NÓŻKI (jeśli bez cokołu) -->
    @if (showFeet) {
      @for (foot of getFeetPositions(); track $index) {
        <g class="foot">
          <!-- Nóżka - walec uproszczony -->
          <rect
            [attr.x]="foot.x - 4"
            [attr.y]="baseY"
            width="8"
            [attr.height]="baseHeightScaled"
            [attr.fill]="getFeetColor()"
            stroke="#424242"
            stroke-width="0.5"
            rx="2">
            <title>Nóżka</title>
          </rect>
          <!-- Podstawa nóżki -->
          <ellipse
            [attr.cx]="foot.x"
            [attr.cy]="foot.y"
            rx="5"
            ry="2"
            fill="#37474f"
            class="foot-base"/>
        </g>
      }
    }

    <!-- Podłoga (linia) -->
    <line
      [attr.x1]="bodyX - 5"
      [attr.y1]="svgHeight() - SVG_PADDING + 2"
      [attr.x2]="bodyX + bodyWidth + 5"
      [attr.y2]="svgHeight() - SVG_PADDING + 2"
      stroke="#5d4037"
      stroke-width="2"
      class="floor-line"/>

  </svg>
} @else {
  <div class="empty-state">
    Brak danych szafki
  </div>
}
